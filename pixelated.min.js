(()=>{let e={width:12,height:13},t=["#0000ff","#ff0000","#008000","#ffff00","#ffa500","#800080"],n=()=>({grid:[],movesLeft:22,winningStreak:0}),o=n(),r={board:document.getElementById("board"),controls:document.getElementById("controls"),status:document.getElementById("status"),winningStreak:document.getElementById("winning-streak"),newButton:document.getElementById("new-button"),helpButton:document.getElementById("help-button"),helpContainer:document.getElementById("help-container"),helpTitle:document.getElementById("help-title"),helpDescription:document.getElementById("help-description"),helpObjective:document.getElementById("help-objective"),helpInstructions:document.getElementById("help-instructions"),helpControls:document.getElementById("help-controls"),backButton:document.getElementById("back-button"),copyright:document.getElementById("copyright")},i=()=>Array.from({length:e.height},()=>Array.from({length:e.width},()=>t[Math.floor(Math.random()*t.length)])),l=e=>e.flatMap(e=>e.map(e=>`<div class="cell" style="background-color:${e}"></div>`)).join(""),s=()=>t.map(e=>`<button class="color-button" style="background-color:${e}" data-color="${e}"></button>`).join(""),a=(t,n,o=0,r=0)=>{let i=t[0][0];if(n===i)return t;let l=t.map(e=>[...e]),s=(t,o)=>{t<0||o<0||t>=e.width||o>=e.height||l[o][t]!==i||(l[o][t]=n,[[1,0],[-1,0],[0,1],[0,-1],].forEach(([e,n])=>s(t+e,o+n)))};return s(o,r),l},d=e=>{let t=e[0][0];return e.every(e=>e.every(e=>e===t))},c=()=>{r.board.style.gridTemplateColumns=`repeat(${e.width}, 1fr)`,r.board.innerHTML=l(o.grid)},g=()=>{r.controls.innerHTML=s(),r.controls.querySelectorAll(".color-button").forEach(e=>e.addEventListener("click",()=>p(e.dataset.color)))},h=()=>{r.status.textContent=TEXTS.MOVES_LEFT(o.movesLeft)},E=(e=!1)=>{o={...o,winningStreak:e?0:o.winningStreak+1},e?r.winningStreak.classList.add("hidden"):(r.winningStreak.classList.remove("hidden"),r.winningStreak.textContent=`${TEXTS.WINNING_STREAK}${o.winningStreak}`)},$=()=>{let e=o.winningStreak;o={...n(),grid:i(),winningStreak:e},c(),g(),h(),e>0?(r.winningStreak.classList.remove("hidden"),r.winningStreak.textContent=`${TEXTS.WINNING_STREAK}${e}`):r.winningStreak.classList.add("hidden"),S()},p=e=>{!(o.movesLeft<=0)&&(o={...o,grid:a(o.grid,e),movesLeft:o.movesLeft-1},c(),h(),d(o.grid)?(u(TEXTS.WIN_MESSAGE(o.movesLeft)),E(!1)):o.movesLeft<=0&&(u(TEXTS.LOSS_MESSAGE),E(!0)))},u=e=>{r.status.textContent=e,m()},L=e=>{r.helpContainer.classList.toggle("hidden",!e),r.helpContainer.classList.toggle("visible",e)},m=()=>{r.controls.querySelectorAll(".color-button").forEach(e=>e.disabled=!0)},S=()=>{r.controls.querySelectorAll(".color-button").forEach(e=>e.disabled=!1)},f=()=>{r.newButton.addEventListener("click",$),r.helpButton.addEventListener("click",()=>L(!0)),r.backButton.addEventListener("click",()=>L(!1)),r.board.addEventListener("contextmenu",e=>e.preventDefault())},v=()=>{r.newButton.textContent=TEXTS.NEW_BUTTON,r.helpTitle.textContent=TEXTS.HELP_TITLE,r.helpDescription.textContent=TEXTS.HELP_DESCRIPTION,r.helpObjective.textContent=TEXTS.HELP_OBJECTIVE,r.helpInstructions.textContent=TEXTS.HELP_INSTRUCTIONS,r.helpControls.textContent=TEXTS.HELP_CONTROLS,r.backButton.textContent=TEXTS.BACK_BUTTON,r.copyright.innerHTML=TEXTS.COPYRIGHT},k=()=>{"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Service Worker registered with scope:",e.scope)}).catch(e=>{console.log("Service Worker registration failed:",e)})})},I=()=>{f(),v(),$(),k()};document.addEventListener("DOMContentLoaded",I)})();